// AUTOGENERATED FILE: Do not edit.
package resource

import (
	"github.com/omniview/kubernetes/pkg/plugin/helm"
	"github.com/omniview/kubernetes/pkg/plugin/resource/clients"
	"github.com/omniview/kubernetes/pkg/plugin/resource/resourcers"
	"github.com/omniview/kubernetes/pkg/plugin/resource/resourcers/extras/benchmark"
	"github.com/omniviewdev/plugin-sdk/pkg/resource/types"
	"github.com/omniviewdev/plugin-sdk/pkg/sdk"
	pkgtypes "github.com/omniviewdev/plugin-sdk/pkg/types"
	"go.uber.org/zap"

  "k8s.io/apimachinery/pkg/runtime/schema"
  {{- range .Packages }}
  {{- if eq .ImportName "apiextensionsv1" }}
  {{.ImportName}} "k8s.io/apiextensions-apiserver/pkg/apis/apiextensions/v1"
  {{- else if eq .ImportName "apiregistrationv1"}}
  {{.ImportName}} "k8s.io/kube-aggregator/pkg/apis/apiregistration/v1"
  {{- else }}
	{{.ImportName}} "k8s.io/api/{{.ImportPath}}"
  {{- end }}
  {{- end }}
)

// map of the resource strings to their schema.GroupVersionResource
//
//nolint:lll,gochecknoglobals // autogenerated code that's required for each resource
var resourceMap = map[string]schema.GroupVersionResource{
{{- range .Resources}}
  "{{.Group}}::{{.Version}}::{{.Kind}}": {{.ImportName}}.SchemeGroupVersion.WithResource("{{.SGVRName}}"),
{{- end }}
}

//nolint:lll,gochecknoglobals // autogenerated code that's required for each resource
var gvrMap = map[schema.GroupVersionResource]string{
{{- range .Resources}}
  {{.ImportName}}.SchemeGroupVersion.WithResource("{{.SGVRName}}"): "{{.Group}}::{{.Version}}::{{.Kind}}",
{{- end }}
}

// Register registers the resource plugin with the plugin server.
//
//nolint:funlen // autogenerated code that's required for each resource
func Register(plugin *sdk.Plugin) {
	logger := zap.S()

	// Merge Helm resource definitions into the K8s definitions.
	resourceDefs := make(map[string]types.ResourceDefinition, len(resourcers.ResourceDefs))
	for k, v := range resourcers.ResourceDefs {
		resourceDefs[k] = v
	}
	for k, v := range helm.HelmResourceDefinitions() {
		resourceDefs[k] = v
	}

	// Helm resourcers.
	helmSvc := helm.NewHelmService()
	helmResourcers := helm.HelmResourcers(logger, helmSvc)

	// Collect all registered resource keys for OpenAPI schema fetching.
	registeredKeys := make([]string, 0, len(resourceMap))
	for key := range resourceMap {
		registeredKeys = append(registeredKeys, key)
	}

	sdk.RegisterResourcePlugin(
		plugin,
		sdk.ResourcePluginOpts[clients.ClientSet]{
			CreateClient:                 clients.CreateClient,
			RefreshClient:               clients.RefreshClient,
			ErrorClassifier:             classifyResourceError,
			DiscoveryProvider:            sdk.NewClientDiscoveryProvider(clients.CreateDiscoveryClient, nil, DiscoveryFunc),
			LoadConnectionFunc:           LoadConnectionsFunc,
			WatchConnectionsFunc:         WatchConnectionsFunc,
			LoadConnectionNamespacesFunc: LoadConnectionNamespacesFunc,
			CheckConnectionFunc:          CheckConnectionFunc,
			CreateInformerFunc:           NewKubeInformerHandle,
			ResourceGroups:               ResourceGroups,
			ResourceDefinitions:          resourceDefs,
			DefaultResourceDefinition:    resourcers.DefaultResourceDef,
			SchemaFunc: func(ctx *pkgtypes.PluginContext, client *clients.ClientSet) ([]types.EditorSchema, error) {
				return FetchOpenAPISchemas(ctx, client, registeredKeys)
			},
			PatternResourcers: map[string]types.Resourcer[clients.ClientSet]{
				"*": resourcers.NewKubernetesPatternResourcer(logger),
			},
			Resourcers:                   map[types.ResourceMeta]types.Resourcer[clients.ClientSet]{
        {
          Group: "extras",
          Version: "v1",
          Kind: "ClusterBenchmark",
					Description: `ClusterBenchmark shows information on the configuration of a cluster`,
        }: &benchmark.ClusterBenchmarker{},
        {{- range .Resources}}
				{
          Group:   "{{.Group}}",
          Version: "{{.Version}}",
          Kind:    "{{.Kind}}",
          Description: `{{.Description}}`,
        }:
        {{- if and (eq .Group "core") (eq .Version "v1") (eq .Kind "Node") }} resourcers.NewNodeResourcer(logger),
        {{- else if and (eq .Group "apps") (eq .Version "v1") (eq .Kind "Deployment") }} resourcers.NewDeploymentResourcer(logger),
        {{- else if and (eq .Group "apps") (eq .Version "v1") (eq .Kind "StatefulSet") }} resourcers.NewStatefulSetResourcer(logger),
        {{- else if and (eq .Group "apps") (eq .Version "v1") (eq .Kind "DaemonSet") }} resourcers.NewDaemonSetResourcer(logger),
        {{- else }} resourcers.NewKubernetesResourcerBase[resourcers.MetaAccessor](
					logger,
          {{.ImportName}}.SchemeGroupVersion.WithResource("{{.SGVRName}}"),
				),
        {{- end }}
        {{- end }}

				// Helm resourcers
				helm.ReleaseMeta: helmResourcers[helm.ReleaseMeta],
				helm.RepoMeta:    helmResourcers[helm.RepoMeta],
				helm.ChartMeta:   helmResourcers[helm.ChartMeta],
			},
		},
	)
}
